{% extends "backoffice_base.html" %}

{% load static %}
{% block scripts %}
<script type="module" src="{% static "get-telemetry.js" %}" defer></script>
{% endblock %}

{% block heading %}<h2 class="bg-yellow-400 text-black font-bold text-xl px-6 py-2 rounded-md border-4 border-black tracking-widest shadow-md w-fit">{{ vehicle.registration }}</h2>{% endblock %}
{% block buttons %}

{% endblock %}

{% block main %}

<a class="hidden" href="{{ request.get_host }}" id="base_url"></a>
<a href="{% url "get_telemetry" %}" class="hidden" id="telemetry_url"></a>
<input type="hidden" id="vehicle_id" value="{{ vehicle.id }}">
{% csrf_token %}

<img src="{% if vehicle.picture %}{{ vehicle.picture.url }}{% endif %}""><div class="relative w-32 h-32">
    <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
        <circle class="text-gray-200 stroke-current" cx="50" cy="50" r="40" stroke-width="10" fill="transparent" />
{% if most_recent.soc.value > 75 %}
        <circle class="text-green-500 stroke-current" cx="50" cy="50" r="40" stroke-width="10" fill="transparent"
stroke-dasharray="251.2" stroke-dashoffset="{{ most_recent.soc_dial }}" stroke-linecap="round" />
{% elif most_recent.soc.value > 50 %}
        <circle class="text-amber-500 stroke-current" cx="50" cy="50" r="40" stroke-width="10" fill="transparent"
stroke-dasharray="251.2" stroke-dashoffset="{{ most_recent.soc_dial }}" stroke-linecap="round" />
{% else %}
        <circle class="text-red-500 stroke-current" cx="50" cy="50" r="40" stroke-width="10" fill="transparent"
stroke-dasharray="251.2" stroke-dashoffset="{{ most_recent.soc_dial }}" stroke-linecap="round" />
{% endif %}
    </svg>
    <div class="absolute inset-0 flex items-center justify-center text-xl font-bold text-gray-800">
      {{ most_recent.soc.value }}%
    </div>
  </div>
  <h3>Previous, Current and Next Bookings</h3>
{% include "backoffice/bookings/bookings_list.html" with bookings=bookings %}
<table>
    <thead>
        <th>Telemetry</th>
        <th>Value</th>
        <th>Age</th>
    </thead>
    <tr>
        <td>Doors Locked</td><td>{{ most_recent.doors_locked.value }}</td><td>{{most_recent.doors_locked.age}}</td>
    </tr>
    <tr>
        <td>Battery</td><td>{{ most_recent.battery.value }}v</td><td>{{most_recent.battery.age}}</td>
    </tr>
    <tr>
        <td>Charge</td><td>{{ most_recent.soc.value }}%</td><td>{{most_recent.soc.age}}</td>
    </tr>
    <tr>
        <td>Free Heap</td><td>{{ most_recent.free_heap.value }}</td><td>{{most_recent.free_heap.age}}</td>
    </tr>
    <tr>
        <td>Box Uptime</td><td>{{ most_recent.uptime.value }}</td><td>{{most_recent.uptime.age}}</td>
    </tr>
    <tr>
        <td>Miles Driven</td><td>{{ most_recent.miles.value }}</td><td>{{most_recent.miles.age}}</td>
    </tr>
</table>
    {% include "backoffice/vehicles/telemetry-list.html" with telemetry=page %}

    {% include "backoffice/components/paginator.html" with page=page page_range=page_range %}

    
    <svg id="graph" width="1000"></svg>

{% endblock %}
